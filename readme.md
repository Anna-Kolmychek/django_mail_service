# Проект «Почтовый сервис»

## Общее назначение
Почтовый сервис позволяет создавать рассылки и управлять 
ими. Каждая рассылка содержит набор параметров, таких как периодичность, набор клиентов, содержание и заголовки писем и т.п.
Также почтовый сервис дополнен разделом блога. 
Для персонала выделены роли модератора (контроль пользователей и рассылок) и контент-менеджера (управление публикациями блога).

<br>
<hr>

## Фунциональность
### Регистрация
Основной сервис доступен только зарегистрированным пользователям. Регистрация происходит по почте, требуется подтверждение почты (переход по присланной ссылке).

### Рассылки
На странице «Рассылки» пользователю доступна возможность создать новую рассылку или взаимодействовать с рассылками, которые он создал ранее (просматривать, редактировать, удалять).

В рассылке можно задать
- название рассылки (для удобства пользователя, не отображается клиентам)
- описание рассылки (для удобства пользователя, не отображается клиентам)
- диапазон времени отправки писем
- периодичность (единоразово / ежедневно / еженедельно / ежемесячно)
- статус рассылки
  - создана – рассылка создана, но отправка писем не начата (для возможности заранее создать рассылку)
  - запущена – происходит отправка писем с заданной периодичностью в указанном временном интервале
  - завершена – (для остановки рассылки писем без удаления)
- заголовок письма ( !!! будет отправлено клиенту !!! )
- тело письма ( !!! будет отправлено клиенту !!! )
- список клиентов (клиент определяется почтой, можно дополнительно задать имя и фамилию)

На отправку попадают все письма, в рассылке которых
- статус – запущена
- текущее время в диапазоне отправки

Письма отправляются с указанной периодичностью, письма рассылаются всем клиентам из списка.

Рассылки с периодичностью «один раз» автоматически переходят в статус «завершена», когда письма отправлены всем клиентам из списка. Рассылки с остальными вариантами периодичности необходимо переводить в статус «завершена» вручную.

Если пользователь заблокирован модератором, письма по его рассылкам не отправляются.

### Логи
Для каждого отправленного письма записывается лог со следующей информацией:
- дата, время отправки
- статус (отправлена / ошибка)
- ответ сервера (в случае ошибки отправки)

Логи доступны только администратору в административной панели.

### Раздел «блог»
Содержит страницу со списком всех статей с краткой информацией по ним. И возможность перейти на страницу любой статьи с полной информацией.

Для статей реализован счетчик просмотров (переходов на страницу с полным текстом).

### Роли для персонала. Модератор
Модератор в отличие от обычного пользователя
- видит все рассылки, 
- не имеет возможности создать свою рассылку,
- в режиме редактирования может любую рассылку перевести в статус «завершена»
- не имеет возможности удалить или изменить рассылку в других полях

Для модератора карточка рассылки дополнена именем владельца.

Также для модератора доступен раздел «Пользователи», в котором есть
- страница со списком всех пользователей
- возможность перейти на страницу пользователя (содержит информацию по пользователю и список его рассылок)
- возможность заблокировать пользователя (со страницы редактирования пользователя).

Модератор не имеет доступа к административной панели.

### Роли для персонала. Контент-менеджер
В административной панели контент-менеджер имеет полный доступ к публикациям блога: создание, просмотр, редактирование, удаление.

<br>
<hr>

## Запуск проекта
1. Скопируйте проект, установите виртуальное окружение и зависимости из `requirements.txt`.

2. В корне проекта создайте файл `.env` со следующим содержимым
```
EMAIL_HOST_USER=АДРЕС ПОЧТЫ С КОТОРОЙ БУДЕТ ПРОИСХОДИТ РАССЫЛКА
EMAIL_HOST_PASSWORD=ПАРОЛЬ ОТ ПОЧТЫ С КОТОРОЙ БУДЕТ ПРОИСХОДИТЬ РАССЫЛКА
```

3. В файле `config/settings.py` при необходимости измените настройки базы данных. В проекте используется локальный `postgresql`, база с именем `django_email_service`, пользователь `postgres` с входом для локального подключения без пароля
```
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',
        'NAME': 'django_email_service',
        'USER': 'postgres',
    }
}
```

4. Создайте пустую базу данных с именем `django_email_service` (при локольном входе в `postgresql` без пароля):
```
psql -U postgres
create database django_email_service;
\q
```

5. Примените миграции
```
python3 manage.py migrate
```

6. Создайте администратора, модератора и контент-менеджера
```
python3 manage.py create_su
python3 manage.py create_moderator
python3 manage.py create_content_manager
```

Будут созданы пользователи (и необходимые группы)
- администратор (логин: `admin@mail.com`, пароль: `12345`)
- модератор (логин: `moderator@mail.com`, пароль: `12345`)
- контент-менеджер (логин: `content_manager@mail.com`, пароль: `12345`)

7. При желании загрузите тестовые статьи для блога:
```
python3 manage.py loaddata data_blog.json
```

8. Запустите сервер
```
python3 manage.py runserver
```

### Почтовый сервер запущен, можно работать!

Для знакомства с функциональностью вы можете использовать созданных пользователей
- `content_manager@mail.com` – для управления блогом в административной панели (`127.0.0.1:8000/admin`) или как обычный пользователь сервиса (`127.0.0.1:8000`)
- `moderator@mail.com` – для контроля пользователей и рассылок (`127.0.0.1:8000`). Пользователь не имеет доступа к административной панели.
- `admin@mail.com` – полный доступ ко всем данным в административной панели (`127.0.0.1:8000/admin`)
